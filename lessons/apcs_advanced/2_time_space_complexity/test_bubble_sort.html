<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ³¡æ³¡æ’åºæ¸¬è©¦</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        #test-container { margin: 20px 0; }
        .test-info { background: #f0f0f0; padding: 10px; margin: 10px 0; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>æ³¡æ³¡æ’åºæ¸¬è©¦</h1>
    <div class="test-info">
        <p><strong>æ¸¬è©¦ç›®çš„ï¼š</strong>é©—è­‰æ³¡æ³¡æ’åºæ˜¯å¦æŒ‰ç…§æ­£ç¢ºçš„é †åºåŸ·è¡Œï¼š0~9, 0~8, ..., 0~1</p>
        <p><strong>æ¸¬è©¦é™£åˆ—ï¼š</strong>[4, 2, 7, 1, 3]</p>
    </div>
    
    <button onclick="runTest()">é–‹å§‹æ¸¬è©¦</button>
    <button onclick="resetTest()">é‡ç½®</button>
    
    <div id="test-container"></div>
    <div id="log"></div>
    
    <script src="scripts/bubble_sort.js"></script>
    <script>
        let visualizer;
        let stepCount = 0;
        
        function initTest() {
            visualizer = new BubbleSortVisualizer('test-container', {
                width: 600,
                height: 200,
                onUpdate: (stats) => {
                    document.getElementById('log').innerHTML += 
                        `<div>çµ±è¨ˆï¼šæ¯”è¼ƒ${stats.comparisons}æ¬¡ï¼Œäº¤æ›${stats.swaps}æ¬¡ï¼Œè¼ªæ¬¡${stats.passes}</div>`;
                },
                onStep: (result) => {
                    stepCount++;
                    const logDiv = document.getElementById('log');
                    
                    if (result.action === 'compare') {
                        logDiv.innerHTML += 
                            `<div style="color: red;">æ­¥é©Ÿ${stepCount}ï¼šæ¯”è¼ƒä½ç½®${result.indices[0]}å’Œ${result.indices[1]} (${result.values[0]} vs ${result.values[1]})</div>`;
                    } else if (result.action === 'swap') {
                        logDiv.innerHTML += 
                            `<div style="color: blue;">æ­¥é©Ÿ${stepCount}ï¼šäº¤æ›ä½ç½®${result.indices[0]}å’Œ${result.indices[1]} (${result.values[1]} â†” ${result.values[0]})</div>`;
                    } else if (result.action === 'pass_completed') {
                        logDiv.innerHTML += 
                            `<div style="color: green; font-weight: bold;">--- ç¬¬${result.pass}è¼ªå®Œæˆ ---</div>`;
                    } else if (result.action === 'completed') {
                        logDiv.innerHTML += 
                            `<div style="color: green; font-weight: bold;">ğŸ‰ æ’åºå®Œæˆï¼</div>`;
                    }
                    
                    // è‡ªå‹•æ»¾å‹•åˆ°åº•éƒ¨
                    logDiv.scrollTop = logDiv.scrollHeight;
                },
                onComplete: (stats) => {
                    console.log('æ’åºå®Œæˆï¼', stats);
                }
            });
            
            // è¨­ç½®æ¸¬è©¦è³‡æ–™
            const testData = [4, 2, 7, 1, 3];
            visualizer.setData(testData);
        }
        
        async function runTest() {
            document.getElementById('log').innerHTML = '<h3>åŸ·è¡Œæ—¥èªŒï¼š</h3>';
            stepCount = 0;
            
            if (!visualizer) {
                initTest();
            }
            
            visualizer.setSpeed(1000); // æ…¢é€ŸåŸ·è¡Œä»¥ä¾¿è§€å¯Ÿ
            await visualizer.autoSort();
        }
        
        function resetTest() {
            document.getElementById('log').innerHTML = '';
            stepCount = 0;
            if (visualizer) {
                visualizer.reset();
            }
        }
        
        // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initTest();
        });
    </script>
</body>
</html>