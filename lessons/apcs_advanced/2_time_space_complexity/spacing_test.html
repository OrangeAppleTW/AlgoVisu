<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>間距調整測試</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: #fafafa;
        }
        .test-container {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
        }
        button {
            background: #333;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 12px;
        }
        button:hover { background: #555; }
        h3 { margin-top: 0; color: #333; }
        h4 { color: #666; margin-bottom: 10px; }
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 15px 0;
        }
        .before, .after {
            padding: 15px;
            border: 2px solid;
            border-radius: 6px;
        }
        .before {
            border-color: #ff6b6b;
            background: #fff5f5;
        }
        .after {
            border-color: #51cf66;
            background: #f3fff3;
        }
        .spacing-info {
            background: #e7f3ff;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>📏 間距調整測試</h1>
        <p>比較修改前後長方體之間的間距變化</p>
        
        <div class="test-section">
            <h3>間距調整對比</h3>
            
            <div class="spacing-info">
                <strong>調整說明：</strong>
                <ul>
                    <li><strong>修改前</strong>：寬度比例較小 (40%-60%)，間距較大 (40%-60%)</li>
                    <li><strong>修改後</strong>：寬度比例增加 (60%-80%)，間距減少 (20%-40%)</li>
                </ul>
            </div>
            
            <div class="test-container">
                <h4>8 個元素比較</h4>
                <div class="comparison">
                    <div class="before">
                        <h5>❌ 修改前 (寬度50%, 間距50%)</h5>
                        <div id="before-8"></div>
                    </div>
                    <div class="after">
                        <h5>✅ 修改後 (寬度70%, 間距30%)</h5>
                        <div id="after-8"></div>
                    </div>
                </div>
                <button onclick="compare8Elements()">🔄 重新比較 8 個元素</button>
            </div>
            
            <div class="test-container">
                <h4>5 個元素比較</h4>
                <div class="comparison">
                    <div class="before">
                        <h5>❌ 修改前 (寬度60%, 間距40%)</h5>
                        <div id="before-5"></div>
                    </div>
                    <div class="after">
                        <h5>✅ 修改後 (寬度80%, 間距20%)</h5>
                        <div id="after-5"></div>
                    </div>
                </div>
                <button onclick="compare5Elements()">🔄 重新比較 5 個元素</button>
            </div>
            
            <div class="test-container">
                <h4>12 個元素比較</h4>
                <div class="comparison">
                    <div class="before">
                        <h5>❌ 修改前 (寬度40%, 間距60%)</h5>
                        <div id="before-12"></div>
                    </div>
                    <div class="after">
                        <h5>✅ 修改後 (寬度60%, 間距40%)</h5>
                        <div id="after-12"></div>
                    </div>
                </div>
                <button onclick="compare12Elements()">🔄 重新比較 12 個元素</button>
            </div>
        </div>
        
        <div class="test-section">
            <h3>間距比例對比表</h3>
            <table style="width: 100%; border-collapse: collapse; margin-top: 15px;">
                <thead>
                    <tr style="background: #333; color: white;">
                        <th style="padding: 12px; border: 1px solid #ddd;">元素數量</th>
                        <th style="padding: 12px; border: 1px solid #ddd;">修改前寬度</th>
                        <th style="padding: 12px; border: 1px solid #ddd;">修改前間距</th>
                        <th style="padding: 12px; border: 1px solid #ddd;">修改後寬度</th>
                        <th style="padding: 12px; border: 1px solid #ddd;">修改後間距</th>
                        <th style="padding: 12px; border: 1px solid #ddd;">間距改善</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td style="padding: 8px; border: 1px solid #ddd;">≤5 個</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">60%</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">40%</td>
                        <td style="padding: 8px; border: 1px solid #ddd; background: #f3fff3;">80%</td>
                        <td style="padding: 8px; border: 1px solid #ddd; background: #f3fff3;">20%</td>
                        <td style="padding: 8px; border: 1px solid #ddd; color: green; font-weight: bold;">-50%</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border: 1px solid #ddd;">6-7 個</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">55%</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">45%</td>
                        <td style="padding: 8px; border: 1px solid #ddd; background: #f3fff3;">75%</td>
                        <td style="padding: 8px; border: 1px solid #ddd; background: #f3fff3;">25%</td>
                        <td style="padding: 8px; border: 1px solid #ddd; color: green; font-weight: bold;">-44%</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border: 1px solid #ddd;">8-9 個</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">50%</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">50%</td>
                        <td style="padding: 8px; border: 1px solid #ddd; background: #f3fff3;">70%</td>
                        <td style="padding: 8px; border: 1px solid #ddd; background: #f3fff3;">30%</td>
                        <td style="padding: 8px; border: 1px solid #ddd; color: green; font-weight: bold;">-40%</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border: 1px solid #ddd;">10-11 個</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">45%</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">55%</td>
                        <td style="padding: 8px; border: 1px solid #ddd; background: #f3fff3;">65%</td>
                        <td style="padding: 8px; border: 1px solid #ddd; background: #f3fff3;">35%</td>
                        <td style="padding: 8px; border: 1px solid #ddd; color: green; font-weight: bold;">-36%</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border: 1px solid #ddd;">≥12 個</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">40%</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">60%</td>
                        <td style="padding: 8px; border: 1px solid #ddd; background: #f3fff3;">60%</td>
                        <td style="padding: 8px; border: 1px solid #ddd; background: #f3fff3;">40%</td>
                        <td style="padding: 8px; border: 1px solid #ddd; color: green; font-weight: bold;">-33%</td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <div class="test-section">
            <h3>測試所有情況</h3>
            <button onclick="testAllCases()">🚀 測試所有間距調整</button>
            <button onclick="clearAll()">🗑️ 清除所有</button>
        </div>
    </div>
    
    <script src="scripts/bubble_sort.js"></script>
    <script>
        let visualizers = {};
        
        // 舊的寬度比例設定 (模擬修改前)
        function createOldStyleVisualizer(containerId, elementCount) {
            let oldWidthRatio;
            if (elementCount >= 12) oldWidthRatio = 0.4;
            else if (elementCount >= 10) oldWidthRatio = 0.45;
            else if (elementCount >= 8) oldWidthRatio = 0.5;
            else if (elementCount >= 6) oldWidthRatio = 0.55;
            else oldWidthRatio = 0.6;
            
            // 創建自定義的舊式視覺化器
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            const svg = d3.select(container)
                .append('svg')
                .attr('width', 400)
                .attr('height', 150)
                .style('background-color', '#ffffff')
                .style('border', '1px solid #e0e0e0')
                .style('border-radius', '4px');
                
            const chartArea = svg.append('g')
                .attr('transform', 'translate(20, 20)');
            
            const data = Array.from({ length: elementCount }, (_, i) => i + 1);
            const chartWidth = 360;
            const chartHeight = 110;
            const maxValue = Math.max(...data);
            
            const barWidth = chartWidth / elementCount * oldWidthRatio;
            const barSpacing = chartWidth / elementCount * (1 - oldWidthRatio);
            
            const xScale = (i) => i * (barWidth + barSpacing) + barSpacing / 2;
            const yScale = d3.scaleLinear()
                .domain([0, maxValue])
                .range([chartHeight, 0]);
            
            const barGroups = chartArea.selectAll('.bar-group')
                .data(data)
                .enter()
                .append('g')
                .attr('class', 'bar-group')
                .attr('transform', (d, i) => `translate(${xScale(i)}, 0)`);
            
            barGroups.append('rect')
                .attr('class', 'bar')
                .attr('width', barWidth)
                .attr('height', (d) => chartHeight - yScale(d))
                .attr('y', (d) => yScale(d))
                .attr('fill', '#ffb3b3')
                .attr('stroke', '#888')
                .attr('stroke-width', 1)
                .attr('rx', 2)
                .attr('ry', 2);
            
            const fontSize = Math.max(8, Math.min(10, barWidth * 0.8));
            barGroups.append('text')
                .attr('x', barWidth / 2)
                .attr('y', (d) => yScale(d) - 3)
                .attr('text-anchor', 'middle')
                .attr('fill', '#333')
                .attr('font-family', 'monospace')
                .attr('font-size', `${fontSize}px`)
                .attr('font-weight', 'bold')
                .text((d) => d);
        }
        
        function compare8Elements() {
            createOldStyleVisualizer('before-8', 8);
            
            const visualizer = new BubbleSortVisualizer('after-8', {
                width: 400,
                height: 150
            });
            const data = [1, 2, 3, 4, 5, 6, 7, 8];
            visualizer.setData(data);
        }
        
        function compare5Elements() {
            createOldStyleVisualizer('before-5', 5);
            
            const visualizer = new BubbleSortVisualizer('after-5', {
                width: 400,
                height: 150
            });
            const data = [1, 2, 3, 4, 5];
            visualizer.setData(data);
        }
        
        function compare12Elements() {
            createOldStyleVisualizer('before-12', 12);
            
            const visualizer = new BubbleSortVisualizer('after-12', {
                width: 400,
                height: 150
            });
            const data = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12];
            visualizer.setData(data);
        }
        
        function testAllCases() {
            compare5Elements();
            compare8Elements();
            compare12Elements();
        }
        
        function clearAll() {
            ['before-5', 'after-5', 'before-8', 'after-8', 'before-12', 'after-12'].forEach(id => {
                document.getElementById(id).innerHTML = '';
            });
        }
        
        // 頁面載入時自動測試
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(testAllCases, 500);
        });
    </script>
</body>
</html>