<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é–“è·ç¸®å°èˆ‡ç½®ä¸­æ¸¬è©¦</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: #fafafa;
        }
        .test-container {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            position: relative;
        }
        .test-visual {
            border: 2px dashed #007acc;
            margin: 10px 0;
            position: relative;
        }
        .center-line {
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 1px;
            background: red;
            z-index: 10;
        }
        .center-line::before {
            content: "ä¸­å¿ƒç·š";
            position: absolute;
            top: -20px;
            left: -20px;
            background: red;
            color: white;
            padding: 2px 5px;
            font-size: 10px;
            border-radius: 2px;
        }
        button {
            background: #333;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 12px;
        }
        button:hover { background: #555; }
        h3 { margin-top: 0; color: #333; }
        h4 { color: #666; margin-bottom: 10px; }
        .info-box {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
        }
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 15px 0;
        }
        .before, .after {
            padding: 15px;
            border: 2px solid;
            border-radius: 6px;
        }
        .before {
            border-color: #ff6b6b;
            background: #fff5f5;
        }
        .after {
            border-color: #51cf66;
            background: #f3fff3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“ é–“è·ç¸®å°èˆ‡ç½®ä¸­æ¸¬è©¦</h1>
        <p>ç¶­æŒé•·æ–¹å½¢å¯¬åº¦ä¸è®Šï¼Œåªç¸®å°é–“è·ä¸¦è®“æ•´é«”ç½®ä¸­é¡¯ç¤º</p>
        
        <div class="info-box">
            <h4>ğŸ¯ ä¿®æ”¹ç›®æ¨™</h4>
            <ul>
                <li><strong>ç¶­æŒé•·æ–¹å½¢å¯¬åº¦</strong>ï¼šä¸å¢åŠ é•·æ–¹å½¢çš„åšåº¦</li>
                <li><strong>ç¸®å°é–“è·</strong>ï¼šå°‡é•·æ–¹å½¢é–“çš„é–“è·æ¸›å°‘ 40%</li>
                <li><strong>æ•´é«”ç½®ä¸­</strong>ï¼šæ‰€æœ‰é•·æ–¹å½¢ä½œç‚ºä¸€å€‹æ•´é«”åœ¨å®¹å™¨ä¸­ç½®ä¸­</li>
            </ul>
        </div>
        
        <div class="test-section">
            <h3>1. ç½®ä¸­æ•ˆæœæ¸¬è©¦</h3>
            <p>ç´…è‰²è™›ç·šè¡¨ç¤ºå®¹å™¨ä¸­å¿ƒï¼Œè§€å¯Ÿé•·æ–¹å½¢ç¾¤çµ„æ˜¯å¦ç½®ä¸­</p>
            
            <div class="test-container">
                <h4>5 å€‹å…ƒç´ </h4>
                <div class="test-visual">
                    <div class="center-line"></div>
                    <div id="centered-5"></div>
                </div>
                <button onclick="testCentered(5, 'centered-5')">æ¸¬è©¦ 5 å€‹å…ƒç´ ç½®ä¸­</button>
            </div>
            
            <div class="test-container">
                <h4>8 å€‹å…ƒç´ </h4>
                <div class="test-visual">
                    <div class="center-line"></div>
                    <div id="centered-8"></div>
                </div>
                <button onclick="testCentered(8, 'centered-8')">æ¸¬è©¦ 8 å€‹å…ƒç´ ç½®ä¸­</button>
            </div>
            
            <div class="test-container">
                <h4>12 å€‹å…ƒç´ </h4>
                <div class="test-visual">
                    <div class="center-line"></div>
                    <div id="centered-12"></div>
                </div>
                <button onclick="testCentered(12, 'centered-12')">æ¸¬è©¦ 12 å€‹å…ƒç´ ç½®ä¸­</button>
            </div>
        </div>
        
        <div class="test-section">
            <h3>2. é–“è·ç¸®å°å°æ¯”</h3>
            <p>æ¯”è¼ƒä¿®æ”¹å‰å¾Œçš„é–“è·è®ŠåŒ–</p>
            
            <div class="comparison">
                <div class="before">
                    <h5>âŒ ä¿®æ”¹å‰ï¼šåŸå§‹é–“è·</h5>
                    <div id="before-spacing"></div>
                </div>
                <div class="after">
                    <h5>âœ… ä¿®æ”¹å¾Œï¼šé–“è·ç¸®å° 40%</h5>
                    <div id="after-spacing"></div>
                </div>
            </div>
            
            <button onclick="compareSpacing()">ğŸ”„ æ¯”è¼ƒé–“è·è®ŠåŒ–</button>
        </div>
        
        <div class="test-section">
            <h3>3. æŠ€è¡“èªªæ˜</h3>
            <div class="info-box">
                <h4>å¯¦ç¾æ–¹å¼</h4>
                <ol>
                    <li><strong>ä¿æŒé•·æ–¹å½¢å¯¬åº¦</strong>ï¼š<code>barWidth = chartWidth / dataCount * barWidthRatio</code></li>
                    <li><strong>ç¸®å°é–“è·</strong>ï¼š<code>newSpacing = originalSpacing * 0.6</code></li>
                    <li><strong>è¨ˆç®—ç¸½å¯¬åº¦</strong>ï¼š<code>totalWidth = (barWidth Ã— count) + (spacing Ã— (count-1))</code></li>
                    <li><strong>ç½®ä¸­åç§»</strong>ï¼š<code>centerOffset = (chartWidth - totalWidth) / 2</code></li>
                    <li><strong>æ–°çš„ x åº§æ¨™</strong>ï¼š<code>x = centerOffset + i Ã— (barWidth + newSpacing)</code></li>
                </ol>
            </div>
            
            <button onclick="testAllCentered()">ğŸš€ æ¸¬è©¦æ‰€æœ‰å¤§å°</button>
            <button onclick="clearAll()">ğŸ—‘ï¸ æ¸…é™¤æ‰€æœ‰</button>
        </div>
    </div>
    
    <script src="scripts/bubble_sort.js"></script>
    <script>
        function testCentered(count, containerId) {
            const visualizer = new BubbleSortVisualizer(containerId, {
                width: 600,
                height: 200
            });
            
            const data = Array.from({ length: count }, (_, i) => i + 1);
            visualizer.setData(data);
            
            // æª¢æŸ¥æ˜¯å¦ç½®ä¸­
            setTimeout(() => {
                const container = document.getElementById(containerId);
                const svg = container.querySelector('svg');
                const rects = container.querySelectorAll('rect.bar');
                
                if (rects.length > 0) {
                    const firstRect = rects[0];
                    const lastRect = rects[rects.length - 1];
                    const firstX = parseFloat(firstRect.parentNode.getAttribute('transform').match(/translate\\(([^,]+)/)[1]);
                    const lastX = parseFloat(lastRect.parentNode.getAttribute('transform').match(/translate\\(([^,]+)/)[1]);
                    const barWidth = parseFloat(lastRect.getAttribute('width'));
                    
                    const totalWidth = (lastX + barWidth) - firstX;
                    const svgWidth = parseFloat(svg.getAttribute('width'));
                    const expectedCenter = svgWidth / 2;
                    const actualCenter = firstX + totalWidth / 2;
                    
                    console.log(`${count} å€‹å…ƒç´  - å®¹å™¨å¯¬åº¦: ${svgWidth}, å…§å®¹å¯¬åº¦: ${totalWidth.toFixed(1)}, é æœŸä¸­å¿ƒ: ${expectedCenter}, å¯¦éš›ä¸­å¿ƒ: ${actualCenter.toFixed(1)}`);
                }
            }, 100);
        }
        
        // æ¨¡æ“¬èˆŠçš„é–“è·ï¼ˆä¿®æ”¹å‰ï¼‰
        function createOldSpacingVisualizer(containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            const svg = d3.select(container)
                .append('svg')
                .attr('width', 400)
                .attr('height', 150)
                .style('background-color', '#ffffff')
                .style('border', '1px solid #e0e0e0')
                .style('border-radius', '4px');
                
            const chartArea = svg.append('g')
                .attr('transform', 'translate(20, 20)');
            
            const data = [1, 2, 3, 4, 5, 6, 7, 8];
            const chartWidth = 360;
            const chartHeight = 110;
            const maxValue = 8;
            
            // èˆŠçš„æ–¹å¼ï¼šå‡å‹»åˆ†ä½ˆ
            const barWidth = chartWidth / data.length * 0.5;
            const barSpacing = chartWidth / data.length * 0.5;
            
            const xScale = (i) => i * (barWidth + barSpacing) + barSpacing / 2;
            const yScale = d3.scaleLinear()
                .domain([0, maxValue])
                .range([chartHeight, 0]);
            
            const barGroups = chartArea.selectAll('.bar-group')
                .data(data)
                .enter()
                .append('g')
                .attr('class', 'bar-group')
                .attr('transform', (d, i) => `translate(${xScale(i)}, 0)`);
            
            barGroups.append('rect')
                .attr('class', 'bar')
                .attr('width', barWidth)
                .attr('height', (d) => chartHeight - yScale(d))
                .attr('y', (d) => yScale(d))
                .attr('fill', '#ffb3b3')
                .attr('stroke', '#888')
                .attr('stroke-width', 1)
                .attr('rx', 2)
                .attr('ry', 2);
            
            barGroups.append('text')
                .attr('x', barWidth / 2)
                .attr('y', (d) => yScale(d) - 3)
                .attr('text-anchor', 'middle')
                .attr('fill', '#333')
                .attr('font-family', 'monospace')
                .attr('font-size', '10px')
                .attr('font-weight', 'bold')
                .text((d) => d);
        }
        
        function compareSpacing() {
            createOldSpacingVisualizer('before-spacing');
            
            const visualizer = new BubbleSortVisualizer('after-spacing', {
                width: 400,
                height: 150
            });
            const data = [1, 2, 3, 4, 5, 6, 7, 8];
            visualizer.setData(data);
        }
        
        function testAllCentered() {
            testCentered(5, 'centered-5');
            testCentered(8, 'centered-8');
            testCentered(12, 'centered-12');
            compareSpacing();
        }
        
        function clearAll() {
            ['centered-5', 'centered-8', 'centered-12', 'before-spacing', 'after-spacing'].forEach(id => {
                document.getElementById(id).innerHTML = '';
            });
        }
        
        // é é¢è¼‰å…¥æ™‚è‡ªå‹•æ¸¬è©¦
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(testAllCentered, 500);
        });
    </script>
</body>
</html>