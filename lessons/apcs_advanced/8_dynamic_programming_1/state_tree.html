<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>狀態轉移樹視覺化</title>
    <link rel="stylesheet" href="../../../styles/styles.css">
    <link rel="stylesheet" href="state_tree_styles.css">
</head>
<body>
    <div class="container">
        <h1>狀態轉移樹視覺化</h1>
        
        <div class="intro-section">
            <p>
                透過互動式的狀態轉移樹，深度理解動態規劃中的記憶化概念。
                觀察f(n) = f(n-1) + f(n-2)的轉移關係，以及DP如何避免重複計算。
            </p>
        </div>

        <div class="controls-section">
            <div class="input-group">
                <label for="tree-n">目標值 n:</label>
                <input type="number" id="tree-n" min="3" max="10" value="6">
                <button id="build-tree">建構樹狀圖</button>
                <button id="animate-tree">動畫演示</button>
                <button id="reset-tree">重置</button>
            </div>
            
            <div class="tree-options">
                <label>
                    <input type="checkbox" id="show-duplicates" checked>
                    顯示重複節點
                </label>
                <label>
                    <input type="checkbox" id="show-memoization" checked>
                    顯示記憶化效果
                </label>
                <label>
                    <input type="checkbox" id="show-call-order">
                    顯示調用順序
                </label>
            </div>
        </div>

        <div class="tree-visualization-container">
            <!-- 狀態轉移樹主體 -->
            <div class="main-tree-section">
                <h3>狀態轉移樹</h3>
                <div class="tree-explanation">
                    <p>每個節點代表一個子問題 f(i)。箭頭表示狀態轉移關係。</p>
                    <div class="tree-legend">
                        <span class="legend-item root-node">根節點</span>
                        <span class="legend-item base-case">基礎情況</span>
                        <span class="legend-item computed">已計算</span>
                        <span class="legend-item duplicate">重複計算</span>
                        <span class="legend-item memoized">記憶化查詢</span>
                    </div>
                </div>
                <div class="tree-container" id="tree-container">
                    <!-- 動態生成的SVG樹狀圖 -->
                </div>
            </div>

            <!-- 計算統計 -->
            <div class="calculation-stats">
                <h3>計算統計</h3>
                <div class="stats-container">
                    <div class="stat-item">
                        <span class="stat-label">總節點數:</span>
                        <span class="stat-value" id="total-nodes">-</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">唯一子問題:</span>
                        <span class="stat-value" id="unique-problems">-</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">重複計算:</span>
                        <span class="stat-value" id="duplicate-calculations">-</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">記憶化節省:</span>
                        <span class="stat-value" id="memoization-savings">-</span>
                    </div>
                </div>
            </div>

            <!-- 動畫控制 -->
            <div class="animation-controls" id="animation-controls" style="display: none;">
                <h3>動畫進度</h3>
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="animation-progress"></div>
                    </div>
                    <span class="progress-text" id="progress-text">0%</span>
                </div>
                <div class="animation-buttons">
                    <button id="pause-animation">暫停</button>
                    <button id="resume-animation">繼續</button>
                    <button id="step-animation">單步執行</button>
                </div>
                <div class="animation-info" id="animation-info">
                    準備開始動畫...
                </div>
            </div>
        </div>

        <!-- 詳細分析 -->
        <div class="detailed-analysis">
            <h3>詳細分析</h3>
            
            <!-- 重複計算矩陣 -->
            <div class="duplication-matrix">
                <h4>重複計算矩陣</h4>
                <p>下表顯示每個子問題f(i)在遞迴過程中被計算的次數:</p>
                <div class="matrix-container" id="duplication-matrix">
                    <!-- 動態生成 -->
                </div>
            </div>

            <!-- 記憶化效果 -->
            <div class="memoization-effect">
                <h4>記憶化效果對比</h4>
                <div class="effect-comparison">
                    <div class="before-memoization">
                        <h5>使用記憶化之前</h5>
                        <div class="calculation-flow" id="before-memo">
                            <!-- 顯示重複計算流程 -->
                        </div>
                    </div>
                    <div class="after-memoization">
                        <h5>使用記憶化之後</h5>
                        <div class="calculation-flow" id="after-memo">
                            <!-- 顯示優化後的計算流程 -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- 空間與時間權衡 -->
            <div class="space-time-tradeoff">
                <h4>空間與時間權衡</h4>
                <div class="tradeoff-analysis">
                    <div class="time-analysis">
                        <h5>⏱️ 時間複雜度</h5>
                        <p><strong>純遞迴:</strong> O(2ⁿ) - 指數級成長</p>
                        <p><strong>記憶化:</strong> O(n) - 線性成長</p>
                        <div class="complexity-chart" id="time-complexity-chart"></div>
                    </div>
                    <div class="space-analysis">
                        <h5>💾 空間複雜度</h5>
                        <p><strong>純遞迴:</strong> O(n) - 遞迴調用棧</p>
                        <p><strong>記憶化:</strong> O(n) - 額外的memo表格</p>
                        <div class="space-usage" id="space-usage-chart"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 互動式探索 -->
        <div class="interactive-exploration">
            <h3>互動式探索</h3>
            <div class="exploration-tools">
                <div class="node-inspector">
                    <h4>節點檢查器</h4>
                    <p>點擊樹中的任意節點查看詳細信息:</p>
                    <div class="inspector-content" id="node-inspector">
                        <p>請點擊樹中的節點來查看詳細信息</p>
                    </div>
                </div>
                
                <div class="path-tracer">
                    <h4>路徑追蹤器</h4>
                    <div class="path-controls">
                        <label for="trace-target">追蹤目標:</label>
                        <select id="trace-target">
                            <!-- 動態生成選項 -->
                        </select>
                        <button id="trace-path">追蹤路徑</button>
                        <button id="clear-trace">清除追蹤</button>
                    </div>
                    <div class="trace-info" id="trace-info">
                        <!-- 顯示追蹤信息 -->
                    </div>
                </div>
            </div>
        </div>

        <!-- 學習要點 -->
        <div class="learning-points">
            <h3>學習要點</h3>
            <div class="points-grid">
                <div class="point-card">
                    <h4>🌳 樹狀結構理解</h4>
                    <p>每個節點的值等於其左右子樹的值之和，這正是f(n) = f(n-1) + f(n-2)的體現。</p>
                </div>
                <div class="point-card">
                    <h4>🔄 重疊子問題</h4>
                    <p>相同的f(i)會在樹的不同分支中重複出現，純遞迴會重複計算這些相同的子問題。</p>
                </div>
                <div class="point-card">
                    <h4>💾 記憶化原理</h4>
                    <p>第一次計算f(i)時存儲結果，後續需要f(i)時直接查表，避免重複計算。</p>
                </div>
                <div class="point-card">
                    <h4>⚡ 效率提升</h4>
                    <p>記憶化將時間複雜度從O(2ⁿ)降低到O(n)，代價是額外的O(n)空間存儲。</p>
                </div>
            </div>
        </div>

        <div class="navigation">
            <a href="recursion_vs_dp.html" class="nav-button">← 回到比較分析</a>
            <a href="index.html" class="nav-button">回到課程首頁 →</a>
        </div>
    </div>

    <script src="state_tree_data.js"></script>
    <script src="state_tree_renderer.js"></script>
    <script src="state_tree_controller.js"></script>
    <script src="../../../components/navbar-loader.js"></script>
</body>
</html>