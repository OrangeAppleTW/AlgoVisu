<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¨¹ç‹€åœ–ä¿®å¾©æ¸¬è©¦ - å±…ä¸­èˆ‡ç¯€é»é‡ç–Š</title>
    <link rel="stylesheet" href="focus-mode-styles.css">
</head>
<body>
    <div class="focus-container">
        <!-- å·¦å´ï¼šæ¨¹ç‹€åœ–è¦–è¦ºåŒ–å€åŸŸ -->
        <div class="tree-section">
            <h2 class="section-title">ğŸŒ³ çµ„åˆæœå°‹æ¨¹è¦–è¦ºåŒ–</h2>
            <div class="tree-visualization">
                <div id="combination-tree" class="tree-container">
                    <!-- æ¨¹ç‹€åœ–ç¯€é»æœƒåœ¨é€™è£¡å‹•æ…‹ç”Ÿæˆ -->
                </div>
            </div>
        </div>

        <!-- å³å´ï¼šæ§åˆ¶é¢æ¿ -->
        <div class="control-section">
            <h2 class="section-title">ğŸ® æ§åˆ¶é¢æ¿</h2>
            
            <!-- å•é¡Œè¨­ç½® -->
            <div class="problem-setup">
                <div class="setup-row">
                    <span>å¾é›†åˆé¸æ“‡ï¼š</span>
                    <div class="elements-display">
                        <div class="element-item">1</div>
                        <div class="element-item">2</div>
                        <div class="element-item">3</div>
                    </div>
                </div>
                <div class="setup-row">
                    <span>é¸æ“‡æ•¸é‡ï¼š</span>
                    <select id="m-selector" class="m-selector">
                        <option value="2" selected>2</option>
                        <option value="1">1</option>
                        <option value="3">3</option>
                    </select>
                    <span id="combination-formula">C(3,2) = 3</span>
                </div>
            </div>

            <!-- æ¸¬è©¦èªªæ˜ -->
            <div style="background: #e8f4fd; border: 2px solid #3498db; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                <h4 style="margin: 0 0 10px 0; color: #2c3e50;">ğŸ”§ ä¿®å¾©æ¸¬è©¦é …ç›®</h4>
                <ul style="margin: 0; padding-left: 20px; color: #2c3e50; font-size: 0.9em;">
                    <li>âœ… æ¨¹ç‹€åœ–åœ¨è¦–è¦ºåŒ–å€å¡Šä¸­å±…ä¸­é¡¯ç¤º</li>
                    <li>âœ… æœ€ä¸‹å±¤ç¯€é»ä¸å†é‡ç–Š</li>
                    <li>âœ… æœ€å·¦ä¸‹ç¯€é»é¡¯ç¤ºæ­£ç¢ºå…§å®¹ {1,2,3}</li>
                    <li>âœ… ç¯€é»å°ºå¯¸å’Œé–“è·å„ªåŒ–</li>
                    <li>âœ… éŸ¿æ‡‰å¼è¨­è¨ˆé©é…ä¸åŒè¢å¹•</li>
                </ul>
            </div>

            <!-- çµ„åˆè¨ˆæ•¸ -->
            <div class="combination-counter">
                æ¸¬è©¦ç‹€æ…‹ï¼š<span id="test-status">æº–å‚™æ¸¬è©¦</span>
            </div>

            <!-- ç¯€é»æª¢æŸ¥çµæœ -->
            <div id="node-check-results" style="background: white; border-radius: 8px; padding: 15px; margin-top: 15px; max-height: 200px; overflow-y: auto;">
                <h4 style="margin: 0 0 10px 0; color: #2c3e50;">ç¯€é»æª¢æŸ¥çµæœ</h4>
                <div id="results-content">ç­‰å¾…æª¢æŸ¥...</div>
            </div>
        </div>
    </div>

    <!-- å¼•å…¥ç›¸é—œè…³æœ¬ -->
    <script src="combinations-tree.js"></script>
    
    <script>
        console.log('ğŸ§ª æ¨¹ç‹€åœ–ä¿®å¾©æ¸¬è©¦é–‹å§‹...');
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOMå·²è¼‰å…¥ï¼Œé–‹å§‹ä¿®å¾©æ¸¬è©¦...');
            
            const testStatus = document.getElementById('test-status');
            const resultsContent = document.getElementById('results-content');
            
            function updateResults(message) {
                resultsContent.innerHTML += `<div style="padding: 2px 0; font-size: 0.9em;">${message}</div>`;
                resultsContent.scrollTop = resultsContent.scrollHeight;
            }
            
            try {
                // å‰µå»ºæ¸¬è©¦ç”¨çš„çˆ¶é¡æ¨¡æ“¬
                const mockParent = {
                    combinationTree: document.getElementById('combination-tree'),
                    elements: [1, 2, 3],
                    m: 2,
                    treeNodes: {},
                    treeEdges: []
                };
                
                console.log('ğŸ“‹ é–‹å§‹æ¸¬è©¦é …ç›®...');
                testStatus.textContent = 'æ­£åœ¨å‰µå»ºæ¨¹ç‹€åœ–...';
                updateResults('ğŸš€ é–‹å§‹å‰µå»ºæ¨¹ç‹€åœ–...');
                
                // å‰µå»ºæ¨¹ç‹€åœ–è¦–è¦ºåŒ–å™¨
                const treeVisualizer = new CombinationTreeVisualizer(mockParent);
                console.log('âœ… æ¨¹ç‹€åœ–è¦–è¦ºåŒ–å™¨å‰µå»ºæˆåŠŸ');
                updateResults('âœ… æ¨¹ç‹€åœ–è¦–è¦ºåŒ–å™¨å‰µå»ºæˆåŠŸ');
                
                // å‰µå»ºæ¨¹ç‹€çµæ§‹
                treeVisualizer.createTreeStructure();
                console.log('âœ… æ¨¹ç‹€åœ–çµæ§‹å‰µå»ºæˆåŠŸ');
                updateResults('âœ… æ¨¹ç‹€åœ–çµæ§‹å‰µå»ºæˆåŠŸ');
                
                // æª¢æŸ¥é—œéµç¯€é»
                setTimeout(() => {
                    console.log('ğŸ” æª¢æŸ¥æ¨¹ç‹€åœ–ç¯€é»...');
                    updateResults('ğŸ” é–‹å§‹æª¢æŸ¥ç¯€é»å…§å®¹...');
                    
                    let passedTests = 0;
                    let totalTests = 0;
                    
                    // æ¸¬è©¦é …ç›®åˆ—è¡¨
                    const testNodes = [
                        { id: 'node-root', expected: '{}', description: 'æ ¹ç¯€é»' },
                        { id: 'node-1_s', expected: '{1}', description: 'ç¬¬ä¸€å±¤é¸æ“‡ç¯€é»' },
                        { id: 'node-1_n', expected: 'âˆ…', description: 'ç¬¬ä¸€å±¤è·³éç¯€é»' },
                        { id: 'node-1s_2s', expected: '{1,2}', description: 'ç¬¬äºŒå±¤ {1,2}' },
                        { id: 'node-1s_2s_3s', expected: '{1,2,3}', description: 'æœ€å·¦ä¸‹è§’ç¯€é» (é—œéµæ¸¬è©¦)' },
                        { id: 'node-1s_2s_3n', expected: '{1,2}', description: 'ç¬¬ä¸‰å±¤ {1,2}' },
                        { id: 'node-1s_2n_3s', expected: '{1,3}', description: 'ç¬¬ä¸‰å±¤ {1,3}' },
                        { id: 'node-1n_2s_3s', expected: '{2,3}', description: 'ç¬¬ä¸‰å±¤ {2,3}' }
                    ];
                    
                    testNodes.forEach(test => {
                        totalTests++;
                        const node = document.getElementById(test.id);
                        if (node) {
                            const content = node.textContent;
                            if (content === test.expected) {
                                passedTests++;
                                updateResults(`âœ… ${test.description}: ${content} (æ­£ç¢º)`);
                                console.log(`âœ… ${test.description}: ${content}`);
                            } else {
                                updateResults(`âŒ ${test.description}: æœŸæœ› ${test.expected}, å¯¦éš› ${content}`);
                                console.log(`âŒ ${test.description}: æœŸæœ› ${test.expected}, å¯¦éš› ${content}`);
                            }
                        } else {
                            updateResults(`âŒ ${test.description}: ç¯€é»ä¸å­˜åœ¨`);
                            console.log(`âŒ ${test.description}: ç¯€é»ä¸å­˜åœ¨`);
                        }
                    });
                    
                    // æª¢æŸ¥ç¯€é»ä½ç½®ï¼ˆé¿å…é‡ç–Šï¼‰
                    updateResults('ğŸ” æª¢æŸ¥ç¯€é»ä½ç½®å’Œé‡ç–Š...');
                    const allNodes = document.querySelectorAll('.tree-node');
                    let overlapCount = 0;
                    
                    for (let i = 0; i < allNodes.length; i++) {
                        for (let j = i + 1; j < allNodes.length; j++) {
                            const rect1 = allNodes[i].getBoundingClientRect();
                            const rect2 = allNodes[j].getBoundingClientRect();
                            
                            // æª¢æŸ¥æ˜¯å¦é‡ç–Š
                            if (!(rect1.right < rect2.left || 
                                  rect1.left > rect2.right || 
                                  rect1.bottom < rect2.top || 
                                  rect1.top > rect2.bottom)) {
                                overlapCount++;
                            }
                        }
                    }
                    
                    if (overlapCount === 0) {
                        updateResults('âœ… ç¯€é»ä½ç½®æª¢æŸ¥: ç„¡é‡ç–Š');
                        passedTests++;
                    } else {
                        updateResults(`âŒ ç¯€é»ä½ç½®æª¢æŸ¥: ç™¼ç¾ ${overlapCount} å€‹é‡ç–Š`);
                    }
                    totalTests++;
                    
                    // ç¸½çµæ¸¬è©¦çµæœ
                    const successRate = (passedTests / totalTests * 100).toFixed(1);
                    updateResults(`ğŸ“Š æ¸¬è©¦å®Œæˆ: ${passedTests}/${totalTests} é€šé (${successRate}%)`);
                    
                    if (passedTests === totalTests) {
                        testStatus.textContent = 'âœ… æ‰€æœ‰æ¸¬è©¦é€šé';
                        testStatus.style.color = '#27ae60';
                    } else {
                        testStatus.textContent = `âš ï¸ ${passedTests}/${totalTests} æ¸¬è©¦é€šé`;
                        testStatus.style.color = '#f39c12';
                    }
                    
                }, 500);
                
                // æ¸¬è©¦éŸ¿æ‡‰å¼æ•ˆæœ
                setTimeout(() => {
                    updateResults('ğŸ“± æ¸¬è©¦éŸ¿æ‡‰å¼è¨­è¨ˆ...');
                    const container = document.querySelector('.tree-container');
                    const computedStyle = window.getComputedStyle(container);
                    updateResults(`ğŸ“ å®¹å™¨é–“è·: å·¦${computedStyle.paddingLeft} å³${computedStyle.paddingRight}`);
                }, 1000);
                
            } catch (error) {
                console.error('âŒ æ¸¬è©¦å¤±æ•—:', error);
                testStatus.textContent = 'âŒ æ¸¬è©¦å¤±æ•—';
                testStatus.style.color = '#e74c3c';
                updateResults(`âŒ æ¸¬è©¦å¤±æ•—: ${error.message}`);
            }
        });
        
        // è¦–çª—å¤§å°æ”¹è®Šæ™‚çš„æ¸¬è©¦
        window.addEventListener('resize', function() {
            console.log('ğŸ“± è¦–çª—å¤§å°æ”¹è®Šï¼Œæª¢æŸ¥éŸ¿æ‡‰å¼æ•ˆæœ');
            const resultsContent = document.getElementById('results-content');
            if (resultsContent) {
                const container = document.querySelector('.tree-container');
                if (container) {
                    const computedStyle = window.getComputedStyle(container);
                    resultsContent.innerHTML += `<div style="padding: 2px 0; font-size: 0.9em;">ğŸ“± éŸ¿æ‡‰å¼: å·¦${computedStyle.paddingLeft} å³${computedStyle.paddingRight}</div>`;
                }
            }
        });
    </script>
</body>
</html>