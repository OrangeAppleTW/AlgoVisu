<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çµ„åˆæšèˆ‰æ¨¹ç‹€åœ–ä¿®å¾©é©—è­‰</title>
    <link rel="stylesheet" href="focus-mode-styles.css">
    <style>
        .fix-status {
            background: linear-gradient(135deg, #e8f5e8, #f0fff0);
            border: 2px solid #28a745;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 8px rgba(40, 167, 69, 0.1);
        }
        
        .fix-status h3 {
            color: #155724;
            margin: 0 0 15px 0;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .check-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 0;
            border-bottom: 1px solid #d4edda;
        }
        
        .check-item:last-child {
            border-bottom: none;
        }
        
        .check-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }
        
        .check-pass {
            background: #28a745;
            color: white;
        }
        
        .check-fail {
            background: #dc3545;
            color: white;
        }
        
        .demo-button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            margin: 10px 0;
            transition: all 0.3s ease;
        }
        
        .demo-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
        }
        
        .tree-highlight {
            background: rgba(255, 235, 59, 0.3);
            border: 2px solid #ffc107;
            border-radius: 4px;
            animation: highlight-pulse 2s ease-in-out infinite;
        }
        
        @keyframes highlight-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
    </style>
</head>
<body>
    <div class="focus-container">
        <!-- å·¦å´ï¼šæ¨¹ç‹€åœ–è¦–è¦ºåŒ–å€åŸŸ -->
        <div class="tree-section">
            <h2 class="section-title">ğŸŒ³ çµ„åˆæšèˆ‰æ¨¹ç‹€åœ– - ä¿®å¾©é©—è­‰ç‰ˆ</h2>
            
            <!-- ä¿®å¾©ç‹€æ…‹é¡¯ç¤º -->
            <div class="fix-status">
                <h3>ğŸ”§ ä¿®å¾©é …ç›®æª¢æŸ¥</h3>
                <div id="fix-checks">
                    <div class="check-item">
                        <div class="check-icon" id="check1">?</div>
                        <span>ç¯€é»å…§å®¹é¡¯ç¤ºæ­£ç¢º ({1,2,3} ä¸å†é¡¯ç¤ºç‚º {3})</span>
                    </div>
                    <div class="check-item">
                        <div class="check-icon" id="check2">?</div>
                        <span>é‚Šé€£æ¥é‚è¼¯å®Œæ•´ (æ‰€æœ‰ç¯€é»éƒ½æœ‰æ­£ç¢ºçš„å­ç¯€é»)</span>
                    </div>
                    <div class="check-item">
                        <div class="check-icon" id="check3">?</div>
                        <span>æ¨¹ç‹€çµæ§‹ç¬¦åˆçµ„åˆæšèˆ‰é‚è¼¯</span>
                    </div>
                    <div class="check-item">
                        <div class="check-icon" id="check4">?</div>
                        <span>é—œéµè·¯å¾‘é©—è­‰ ({} â†’ {1,2} â†’ {1,2,3})</span>
                    </div>
                </div>
            </div>
            
            <div class="tree-visualization">
                <div id="combination-tree" class="tree-container">
                    <!-- æ¨¹ç‹€åœ–ç¯€é»æœƒåœ¨é€™è£¡å‹•æ…‹ç”Ÿæˆ -->
                </div>
            </div>
        </div>

        <!-- å³å´ï¼šè©³ç´°é©—è­‰é¢æ¿ -->
        <div class="control-section">
            <h2 class="section-title">ğŸ” è©³ç´°é©—è­‰å ±å‘Š</h2>
            
            <!-- é—œéµç¯€é»æ¸¬è©¦ -->
            <div style="background: white; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                <h4 style="margin: 0 0 15px 0; color: #2c3e50;">é—œéµç¯€é»å…§å®¹é©—è­‰</h4>
                <div id="node-verification" style="font-family: monospace; font-size: 0.9em;">
                    æ­£åœ¨æª¢æŸ¥ç¯€é»å…§å®¹...
                </div>
            </div>

            <!-- é‚Šé€£æ¥æ¸¬è©¦ -->
            <div style="background: white; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                <h4 style="margin: 0 0 15px 0; color: #2c3e50;">é‚Šé€£æ¥å®Œæ•´æ€§æª¢æŸ¥</h4>
                <div id="edge-verification" style="font-family: monospace; font-size: 0.9em;">
                    æ­£åœ¨æª¢æŸ¥é‚Šé€£æ¥...
                </div>
            </div>

            <!-- äº’å‹•æ¸¬è©¦æŒ‰éˆ• -->
            <button class="demo-button" onclick="highlightKeyPath()">
                ğŸ¯ é«˜äº®é—œéµè·¯å¾‘ ({} â†’ {1,2} â†’ {1,2,3})
            </button>
            
            <button class="demo-button" onclick="runFullVerification()">
                ğŸ§ª åŸ·è¡Œå®Œæ•´é©—è­‰æ¸¬è©¦
            </button>
            
            <button class="demo-button" onclick="resetHighlights()">
                ğŸ”„ é‡ç½®é«˜äº®é¡¯ç¤º
            </button>

            <!-- ç¸½çµå ±å‘Š -->
            <div id="summary-report" style="background: #f8f9fa; border-radius: 8px; padding: 15px; margin-top: 20px; display: none;">
                <h4 style="margin: 0 0 10px 0; color: #2c3e50;">ğŸ“Š é©—è­‰ç¸½çµ</h4>
                <div id="summary-content"></div>
            </div>
        </div>
    </div>

    <!-- å¼•å…¥ç›¸é—œè…³æœ¬ -->
    <script src="combinations-tree.js"></script>
    
    <script>
        let treeVisualizer = null;
        let mockParent = null;
        let verificationResults = {
            nodeContent: false,
            edgeConnections: false,
            treeLogic: false,
            keyPath: false
        };

        function updateCheckStatus(checkId, passed) {
            const checkIcon = document.getElementById(checkId);
            if (passed) {
                checkIcon.textContent = 'âœ“';
                checkIcon.className = 'check-icon check-pass';
            } else {
                checkIcon.textContent = 'âœ—';
                checkIcon.className = 'check-icon check-fail';
            }
        }

        function addVerificationMessage(containerId, message, type = 'info') {
            const container = document.getElementById(containerId);
            const color = type === 'success' ? '#28a745' : (type === 'error' ? '#dc3545' : '#007bff');
            container.innerHTML += `<div style="color: ${color}; padding: 3px 0;">${message}</div>`;
        }

        function verifyNodeContent() {
            addVerificationMessage('node-verification', 'ğŸ” æª¢æŸ¥é—œéµç¯€é»å…§å®¹...', 'info');
            
            const keyNodes = [
                { id: 'node-1s_2s_3s', expected: '{1,2,3}', description: 'ä¸‰å…ƒç´ çµ„åˆç¯€é»' },
                { id: 'node-1s_2s', expected: '{1,2}', description: 'äºŒå…ƒç´ çµ„åˆç¯€é»' },
                { id: 'node-1s_2n_3s', expected: '{1,3}', description: 'è·³èºçµ„åˆç¯€é»' },
                { id: 'node-1n_2n_3n', expected: 'âˆ…', description: 'ç©ºé›†ç¯€é»' }
            ];

            let passedCount = 0;
            keyNodes.forEach(test => {
                const node = document.getElementById(test.id);
                if (node) {
                    const actualContent = node.textContent.trim();
                    if (actualContent === test.expected) {
                        addVerificationMessage('node-verification', `âœ… ${test.description}: ${actualContent}`, 'success');
                        passedCount++;
                    } else {
                        addVerificationMessage('node-verification', `âŒ ${test.description}: æœŸæœ› "${test.expected}", å¯¦éš› "${actualContent}"`, 'error');
                    }
                } else {
                    addVerificationMessage('node-verification', `âŒ ${test.description}: ç¯€é»ä¸å­˜åœ¨`, 'error');
                }
            });

            verificationResults.nodeContent = passedCount === keyNodes.length;
            updateCheckStatus('check1', verificationResults.nodeContent);
            return verificationResults.nodeContent;
        }

        function verifyEdgeConnections() {
            addVerificationMessage('edge-verification', 'ğŸ” æª¢æŸ¥é—œéµé‚Šé€£æ¥...', 'info');
            
            const keyEdges = [
                { from: '1s_2s', to: '1s_2s_3s', description: '{1,2} â†’ {1,2,3} (é¸æ“‡3)' },
                { from: '1s_2s', to: '1s_2s_3n', description: '{1,2} â†’ {1,2} (è·³é3)' },
                { from: '1s_2n', to: '1s_2n_3s', description: '{1} â†’ {1,3} (é¸æ“‡3)' },
                { from: '1s_2n', to: '1s_2n_3n', description: '{1} â†’ {1} (è·³é3)' },
                { from: '1n_2n', to: '1n_2n_3s', description: '{} â†’ {3} (é¸æ“‡3)' },
                { from: '1n_2n', to: '1n_2n_3n', description: '{} â†’ {} (è·³é3)' }
            ];

            let passedCount = 0;
            keyEdges.forEach(test => {
                const edgeId = `edge-${test.from}-${test.to}`;
                const edge = document.getElementById(edgeId);
                if (edge) {
                    addVerificationMessage('edge-verification', `âœ… ${test.description}`, 'success');
                    passedCount++;
                } else {
                    addVerificationMessage('edge-verification', `âŒ ç¼ºå¤±: ${test.description}`, 'error');
                }
            });

            verificationResults.edgeConnections = passedCount === keyEdges.length;
            updateCheckStatus('check2', verificationResults.edgeConnections);
            return verificationResults.edgeConnections;
        }

        function verifyTreeLogic() {
            // æª¢æŸ¥æ¨¹çš„é‚è¼¯çµæ§‹æ˜¯å¦æ­£ç¢º
            const logicCheck = verificationResults.nodeContent && verificationResults.edgeConnections;
            verificationResults.treeLogic = logicCheck;
            updateCheckStatus('check3', logicCheck);
            return logicCheck;
        }

        function verifyKeyPath() {
            // æª¢æŸ¥é—œéµè·¯å¾‘ï¼š{} â†’ {1,2} â†’ {1,2,3}
            const pathNodes = ['root', '1_s', '1s_2s', '1s_2s_3s'];
            let pathExists = true;
            
            pathNodes.forEach(nodeId => {
                const nodeElementId = nodeId === 'root' ? 'node-root' : `node-${nodeId}`;
                const node = document.getElementById(nodeElementId);
                if (!node) {
                    pathExists = false;
                }
            });

            verificationResults.keyPath = pathExists;
            updateCheckStatus('check4', pathExists);
            return pathExists;
        }

        function highlightKeyPath() {
            resetHighlights();
            
            // é«˜äº®é—œéµè·¯å¾‘ä¸Šçš„ç¯€é»
            const pathNodes = ['node-root', 'node-1_s', 'node-1s_2s', 'node-1s_2s_3s'];
            pathNodes.forEach((nodeId, index) => {
                const node = document.getElementById(nodeId);
                if (node) {
                    setTimeout(() => {
                        node.classList.add('tree-highlight');
                    }, index * 500);
                }
            });

            // é«˜äº®é—œéµè·¯å¾‘ä¸Šçš„é‚Š
            const pathEdges = ['edge-root-1_s', 'edge-1_s-1s_2s', 'edge-1s_2s-1s_2s_3s'];
            pathEdges.forEach((edgeId, index) => {
                const edge = document.getElementById(edgeId);
                if (edge) {
                    setTimeout(() => {
                        edge.classList.add('tree-highlight');
                    }, (index + 1) * 500);
                }
            });
        }

        function resetHighlights() {
            document.querySelectorAll('.tree-highlight').forEach(element => {
                element.classList.remove('tree-highlight');
            });
        }

        function runFullVerification() {
            // æ¸…ç©ºä¹‹å‰çš„çµæœ
            document.getElementById('node-verification').innerHTML = '';
            document.getElementById('edge-verification').innerHTML = '';
            
            // åŸ·è¡Œæ‰€æœ‰é©—è­‰
            const nodeTest = verifyNodeContent();
            const edgeTest = verifyEdgeConnections();
            const logicTest = verifyTreeLogic();
            const pathTest = verifyKeyPath();
            
            // é¡¯ç¤ºç¸½çµå ±å‘Š
            const totalTests = 4;
            const passedTests = Object.values(verificationResults).filter(Boolean).length;
            const successRate = ((passedTests / totalTests) * 100).toFixed(1);
            
            const summaryReport = document.getElementById('summary-report');
            const summaryContent = document.getElementById('summary-content');
            
            summaryContent.innerHTML = `
                <div style="margin-bottom: 10px;">
                    <strong>é€šéç‡ï¼š${successRate}% (${passedTests}/${totalTests})</strong>
                </div>
                <div style="font-size: 0.9em; color: ${passedTests === totalTests ? '#28a745' : '#dc3545'};">
                    ${passedTests === totalTests ? 
                        'ğŸ‰ æ‰€æœ‰æ¸¬è©¦é€šéï¼çµ„åˆæšèˆ‰æ¨¹ç‹€åœ–å·²æˆåŠŸä¿®å¾©ã€‚' : 
                        'âš ï¸ ä»æœ‰éƒ¨åˆ†å•é¡Œéœ€è¦è§£æ±ºã€‚è«‹æª¢æŸ¥å¤±æ•—çš„æ¸¬è©¦é …ç›®ã€‚'
                    }
                </div>
            `;
            
            summaryReport.style.display = 'block';
        }

        document.addEventListener('DOMContentLoaded', function() {
            // å‰µå»ºæ¸¬è©¦ç”¨çš„çˆ¶é¡æ¨¡æ“¬
            mockParent = {
                combinationTree: document.getElementById('combination-tree'),
                elements: [1, 2, 3],
                m: 2,
                treeNodes: {},
                treeEdges: []
            };

            try {
                // å‰µå»ºæ¨¹ç‹€åœ–è¦–è¦ºåŒ–å™¨
                treeVisualizer = new CombinationTreeVisualizer(mockParent);
                treeVisualizer.createTreeStructure();
                
                // å»¶é²åŸ·è¡Œé©—è­‰ï¼Œç­‰å¾…DOMæ¸²æŸ“
                setTimeout(() => {
                    runFullVerification();
                }, 1000);
                
            } catch (error) {
                console.error('åˆå§‹åŒ–å¤±æ•—:', error);
                alert(`åˆå§‹åŒ–å¤±æ•—: ${error.message}`);
            }
        });
    </script>
</body>
</html>